<!-- company-admin-dashboard.component.html -->
<div class="company-admin-dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-main">
        <h1>Tableau de Bord Entreprise</h1>
        <div class="company-info" *ngIf="company$ | async as company">
          <div class="company-avatar">
            <img
              *ngIf="company.logoUrl"
              [src]="company.logoUrl"
              [alt]="company.name"
            />
            <div *ngIf="!company.logoUrl" class="avatar-placeholder">
              {{ company.name.charAt(0) }}
            </div>
          </div>
          <div class="company-details">
            <h2>{{ company.name }}</h2>
            <p class="plan-badge" [class]="company.activePlan?.toLowerCase()">
              {{ company.activePlan }} Plan
            </p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Navigation Tabs -->
     <div class="dashboard-tap-main">
    <nav class="dashboard-tabs">
      <button
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')"
      >
        <div class="tab-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <span>Vue d'ensemble</span>
      </button>
      <button
        [class.active]="activeTab === 'services'"
        (click)="setActiveTab('services')"
      >
        <div class="tab-icon">
          <i class="fas fa-concierge-bell"></i>
        </div>
        <span>Services</span>
      </button>
      <button
        [class.active]="activeTab === 'bookings'"
        (click)="setActiveTab('bookings')"
      >
        <div class="tab-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <span>Réservations</span>
      </button>
      <button
        [class.active]="activeTab === 'employees'"
        (click)="setActiveTab('employees')"
      >
        <div class="tab-icon">
          <i class="fas fa-users"></i>
        </div>
        <span>Employés</span>
      </button>
    </nav>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading$ | async" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Chargement...</p>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="!(loading$ | async)">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="tab-content">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon services">
              <i class="fas fa-concierge-bell"></i>
            </div>
            <div class="stat-info">
              <h3>{{ (services$ | async)?.length || 0 }}</h3>
              <p>Services Actifs</p>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="stat-card">
            <div class="stat-icon bookings">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-info">
              <h3>{{ (bookings$ | async)?.length || 0 }}</h3>
              <p>Réservations Total</p>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="stat-card">
            <div class="stat-icon employees">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
              <h3>{{ (employees$ | async)?.length || 0 }}</h3>
              <p>Employés</p>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="stat-card">
            <div class="stat-icon revenue">
              <i class="fas fa-euro-sign"></i>
            </div>
            <div class="stat-info">
              <h3>{{ getTotalRevenue(bookings$ | async) }}€</h3>
              <p>Revenu Total</p>
            </div>
            <div class="stat-decoration"></div>
          </div>
        </div>

        <!-- Recent Bookings -->
        <div class="recent-section">
          <div class="section-header">
            <h3>Réservations Récentes</h3>
            <a href="#" class="view-all-link">Voir tout</a>
          </div>
          <div class="bookings-list">
            <div
              *ngFor="let booking of (bookings$ | async)?.slice(0, 5)"
              class="booking-item"
              [class]="booking.status.toLowerCase()"
            >
              <div class="booking-info">
                <div class="booking-service">
                  <strong>{{ booking.serviceName }}</strong>
                  <span class="booking-date">{{ booking.startTime | date : "dd/MM/yyyy HH:mm" }}</span>
                </div>
                <div class="booking-client">{{ booking.clientName }}</div>
              </div>
              <div class="booking-status">
                <span class="status-badge" [class]="booking.status.toLowerCase()">
                  {{ booking.status }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Services Tab -->
      <div *ngIf="activeTab === 'services'" class="tab-content">
        <div class="section-header">
          <h2>Gestion des Services</h2>
          <button class="btn-primary" (click)="openServiceModal()">
            <i class="fas fa-plus"></i>
            Nouveau Service
          </button>
        </div>

        <div class="services-grid">
          <div *ngFor="let service of services$ | async" class="service-card">
            <div class="service-header">
              <h3>{{ service.name }}</h3>
              <span class="price-tag">{{ service.basePrice }}€</span>
            </div>
            <p class="service-description">{{ service.description }}</p>
            <div class="service-footer">
              <div class="service-meta">
                <span class="service-duration">
                  <i class="fas fa-clock"></i>
                  {{ service.durationInMinutes}} min
                </span>
              </div>
              <div class="service-actions">
                <button class="btn-edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bookings Tab -->
      <div *ngIf="activeTab === 'bookings'" class="tab-content">
        <div class="section-header">
          <h2>Gestion des Réservations</h2>
          <div class="filter-controls">
            <select class="filter-select">
              <option>Toutes les réservations</option>
              <option>En attente</option>
              <option>Confirmées</option>
              <option>Terminées</option>
            </select>
          </div>
        </div>

        <div class="bookings-table-container">
          <div class="bookings-table">
            <div class="table-header">
              <div>Client</div>
              <div>Service</div>
              <div>Date</div>
              <div>Prix</div>
              <div>Statut</div>
              <div>Employé</div>
              <div>Actions</div>
            </div>

            <div *ngFor="let booking of bookings$ | async" class="table-row">
              <div class="client-cell">
                <div class="client-avatar">
                  {{ booking.clientName.charAt(0) }}
                </div>
                <span>{{ booking.clientName }}</span>
              </div>
              <div>{{ booking.serviceName }}</div>
              <div>{{ booking.startTime | date : "dd/MM/yyyy HH:mm" }}</div>
              <div class="price-cell">{{ booking.price }}€</div>
              <div>
                <span class="status-badge" [class]="booking.status.toLowerCase()">
                  {{ booking.status }}
                </span>
              </div>
              <div>
                <select
                  *ngIf="booking.status === 'PENDING'"
                  #employeeSelect
                  (change)="
                    assignEmployeeToBooking(booking.id, employeeSelect.value)
                  "
                  class="employee-select"
                >
                  <option value="">Assigner un employé</option>
                  <option
                    *ngFor="let employee of employees$ | async"
                    [value]="employee.id"
                  >
                    {{ employee.name }}
                  </option>
                </select>

                <span *ngIf="booking.assignedEmployeeName" class="assigned-employee">
                  {{ booking.assignedEmployeeName }}
                </span>
              </div>
              <div class="actions">
                <button
                  *ngIf="booking.status === 'PENDING'"
                  class="btn-confirm"
                  (click)="updateBookingStatus(booking.id, 'CONFIRMED')"
                >
                  Confirmer
                </button>
                <button
                  *ngIf="booking.status === 'CONFIRMED'"
                  class="btn-complete"
                  (click)="updateBookingStatus(booking.id, 'COMPLETED')"
                >
                  Terminer
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Employees Tab -->
      <div *ngIf="activeTab === 'employees'" class="tab-content">
        <div class="section-header">
          <h2>Gestion des Employés</h2>
          <button class="btn-primary" (click)="openEmployeeModal()">
            <i class="fas fa-user-plus"></i>
            Nouvel Employé
          </button>
        </div>

        <div class="employees-grid">
          <div *ngFor="let employee of employees$ | async" class="employee-card">
            <div class="employee-avatar">
              {{ employee.name.charAt(0) }}
            </div>
            <div class="employee-info">
              <h3>{{ employee.name }}</h3>
              <p class="employee-email">{{ employee.email }}</p>
              <p class="employee-phone">{{ employee.phone }}</p>
            </div>
            <div class="employee-actions">
              <button class="btn-edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>