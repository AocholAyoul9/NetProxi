<div class="page-container">
  <div class="page-header">
    <h1>Nos Entreprises</h1>
    <p>Trouvez les meilleurs services de nettoyage pr√®s de chez vous.</p>
  </div>

<div class="filters-section">
  <div class="search-box">
    <i class="fas fa-search"></i>
    <input
      type="text"
      placeholder="Rechercher une entreprise..."
      [value]="searchQuery()"
      (input)="onSearchQueryChange($event)"
      class="search-input"
    />
  </div>
  
  <div class="filter-options">
    <h4>Filtrer par service :</h4>
    <div class="service-buttons">
      <button 
        class="filter-btn" 
        [class.active]="activeServiceFilter() === 'Bureaux'"
        (click)="setServiceFilter('Bureaux')">
        <i class="fas fa-building"></i>
        Bureaux
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeServiceFilter() === 'Vitres'"
        (click)="setServiceFilter('Vitres')">
        <i class="fas fa-window-restore"></i>
        Vitres
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeServiceFilter() === 'Tapis'"
        (click)="setServiceFilter('Tapis')">
        <i class="fas fa-rug"></i>
        Tapis
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeServiceFilter() === 'Entretien complet'"
        (click)="setServiceFilter('Entretien complet')">
        <i class="fas fa-home"></i>
        Entretien complet
      </button>
      <button 
        class="filter-btn" 
        [class.active]="activeServiceFilter() === ''"
        (click)="setServiceFilter('')">
        <i class="fas fa-broom"></i>
        Tout
      </button>
    </div>
  </div>
</div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="(filteredCompanies$ | async) as companies">
    <p>{{ getCompaniesCount(companies) }} entreprise(s) trouv√©e(s)</p>
  </div>

  <!-- Company Cards Grid -->
  <div class="company-grid">
    <div *ngFor="let company of filteredCompanies$ | async" class="company-card-wrapper">
      <div class="company-card">
        <!-- Company Header with Logo -->
        <div class="company-header">
          <div class="company-basic-info">
            <div class="company-avatar">
              {{ company.name?.charAt(0) || 'N' }}
            </div>
            <div class="company-title">
              <h3>{{ company.name }}</h3>
              <div class="rating-badge">
                ‚≠ê {{ company.rating || "4.5" }} 
                <span class="reviews-count">({{ company.reviewsCount || 10 }} avis)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Location & Distance -->
        <div class="location-info">
          <div class="location-item">
            <i class="fas fa-map-marker-alt"></i>
            <span class="address">{{ company.address || 'Adresse non disponible' }}</span>
          </div>
          <!--<div class="distance-badge" *ngIf="company.distance !== undefined">
            üìç √Ä {{ formatDistance(company.distance) }}
          </div>
          <div class="distance-badge" *ngIf="company.distance === undefined">
            üìç √Ä {{ formatDistance(getRandomDistance()) }}
          </div>-->
        </div>

        <!-- Contact & Availability -->
        <div class="contact-info">
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <span>{{ company.phone || 'Non renseign√©' }}</span>
          </div>
          <div class="availability" [class.available]="isCompanyAvailable(company)">
            <i class="fas fa-circle"></i>
            {{ isCompanyAvailable(company) ? 'Disponible maintenant' : 'Indisponible' }}
          </div>
        </div>

        <!-- Pricing Information -->
        <div class="pricing-section">
          <div class="pricing-header">
            <i class="fas fa-tag"></i>
            <span>Tarifs :</span>
          </div>
          <div class="price-range">
            {{ getPriceDisplay(company) }}
          </div>
          <small *ngIf="company.minimumPrice">Minimum : {{ company.minimumPrice }} ‚Ç¨</small>
        </div>

        <!-- Services & Specialties -->
        <div class="services-section">
          <h4>Services propos√©s :</h4>
          <div class="service-tags">
            <span
              *ngFor="let service of company.services || []"
              class="service-tag"
              [class.popular]="service.isPopular">
              {{ service.name || "Service" }}
            </span>
            <span *ngIf="!company.services?.length" class="no-services">
              Aucun service renseign√©
            </span>
          </div>
        </div>

        <!-- Company Verification & Trust -->
        <div class="trust-badges">
          <span *ngIf="company.isVerified" class="badge verified">
            <i class="fas fa-shield-check"></i>
            V√©rifi√©
          </span>
          <span *ngIf="company.yearsExperience" class="badge experience">
            <i class="fas fa-trophy"></i>
            {{ company.yearsExperience }} ans d'exp√©rience
          </span>
          <span *ngIf="company.responseTime" class="badge response">
            <i class="fas fa-clock"></i>
            R√©pond en {{ company.responseTime }}h
          </span>
        </div>

        <!-- Quick Actions -->
        <div class="card-actions">
          <button class="btn-primary" (click)="openBooking(company)">
            <i class="fas fa-calendar-check"></i>
            R√©server maintenant
          </button>
          <button class="btn-secondary" (click)="viewDetails(company)">
            <i class="fas fa-info-circle"></i>
            Voir les d√©tails
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="(filteredCompanies$ | async)?.length === 0" class="empty-state">
    <i class="fas fa-building"></i>
    <h3>Aucune entreprise trouv√©e</h3>
    <p>Essayez de modifier vos crit√®res de recherche ou de filtre</p>
    <button class="btn-reset" (click)="setServiceFilter('')">
      <i class="fas fa-refresh"></i>
      R√©initialiser les filtres
    </button>
  </div>
</div>

<!-- Booking Modal -->
<div *ngIf="bookingCompany()" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h3>R√©server {{ bookingCompany()!.name }}</h3>
      <button class="modal-close" (click)="closeBooking()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-content">
      <div class="company-info">
        <div class="company-avatar-small">
          {{ bookingCompany()!.name?.charAt(0) || 'N' }}
        </div>
        <div class="company-details">
          <strong>{{ bookingCompany()!.name }}</strong>
          <div class="company-rating">
            ‚≠ê {{ bookingCompany()!.rating || "4.5" }} ({{ bookingCompany()!.reviewsCount || 10 }} avis)
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="service-select">S√©lectionnez le service :</label>
        <select 
          id="service-select" 
          [ngModel]="selectedService()?.name" 
          (ngModelChange)="onServiceSelect($event)"
          class="service-select">
          <option value="">Choisissez un service</option>
          <option *ngFor="let s of bookingCompany()!.services" [ngValue]="s.name">
            {{ s.name }} - {{ s.basePrice || 'Prix sur demande' }} ‚Ç¨
          </option>
        </select>
      </div>

      <div class="selected-service-info" *ngIf="selectedService()">
        <div class="service-summary">
          <strong>Service s√©lectionn√© :</strong> {{ selectedService()!.name }}
          <span *ngIf="selectedService()!.basePrice" class="service-price">
            - {{ selectedService()!.basePrice }} ‚Ç¨
          </span>
        </div>
        <div class="service-description" *ngIf="selectedService()!.description">
          {{ selectedService()!.description }}
        </div>
      </div>

      <div class="booking-note">
        <i class="fas fa-info-circle"></i>
        Vous recevrez un email de confirmation avec les d√©tails de votre r√©servation.
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-confirm" (click)="confirmBooking()" [disabled]="!selectedService()">
        <i class="fas fa-check"></i>
        Confirmer la r√©servation
      </button>
      <button class="btn-cancel" (click)="closeBooking()">
        <i class="fas fa-times"></i>
        Annuler
      </button>
    </div>

    <div *ngIf="bookingSuccess()" class="booking-success">
      <i class="fas fa-check-circle"></i>
      {{ bookingSuccess() }}
    </div>
  </div>
</div>